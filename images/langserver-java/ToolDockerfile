FROM eclipse-temurin:21-jdk-jammy

ARG JDTLS_URL=https://www.eclipse.org/downloads/download.php?file=/jdtls/milestones/1.50.0/jdt-language-server-1.50.0-202509041425.tar.gz

# WICHTIG: socat installieren!
RUN apt-get update && apt-get install -y wget tar socat && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

WORKDIR /opt/jdt-ls

RUN wget -q "${JDTLS_URL}" -O jdt-ls.tar.gz && \
    tar -xzf jdt-ls.tar.gz && \
    rm jdt-ls.tar.gz && \
    rm -rf config_win config_mac config_ss_win config_ss_mac config_ss_linux bin *.md LICENSE

RUN mkdir -p /opt/workspace

RUN addgroup --system app && adduser --system --group app
RUN chown -R app:app /opt/jdt-ls && chown -R app:app /opt/workspace

COPY images/langserver-java/start-ls.sh /opt/start-ls.sh
RUN chmod +x /opt/start-ls.sh

USER app

EXPOSE 5556

ENTRYPOINT ["/opt/start-ls.sh"]
