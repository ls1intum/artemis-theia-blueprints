// Remote Build Cache Configuration
// Requires GRADLE_REMOTE_CACHE_ENABLED=true AND GRADLE_REMOTE_CACHE_URL to be set

settingsEvaluated { settings ->
    def cacheEnabled = System.getenv('GRADLE_REMOTE_CACHE_ENABLED')?.toLowerCase() == 'true'
    def cacheUrl = System.getenv('GRADLE_REMOTE_CACHE_URL')
    def cachePush = System.getenv('GRADLE_REMOTE_CACHE_PUSH')?.toLowerCase() != 'false'
    
    if (cacheEnabled && cacheUrl?.trim()) {
        // Enable build cache via start parameters
        settings.gradle.startParameter.buildCacheEnabled = true
        
        settings.buildCache {
            local {
                enabled = false
            }
            remote(HttpBuildCache) {
                url = cacheUrl
                push = cachePush
                enabled = true

                // Currently untrusted servers are allowed. When the Cache server allows for tls, this attributes will be removed.
                allowUntrustedServer = true
                allowInsecureProtocol = true
            }
        }
        
        println "[Build Cache] Remote cache ENABLED"
        println "[Build Cache] Push: ${cachePush}"
    } else if (cacheEnabled && !cacheUrl?.trim()) {
        println "[Build Cache] WARNING: Cache enabled but no URL configured"
        println "[Build Cache] Set GRADLE_REMOTE_CACHE_URL to activate remote caching"
    }
}